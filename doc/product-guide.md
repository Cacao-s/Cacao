# Cacao 產品說明書

本文件彙整 Cacao 家庭零用錢管理系統的願景、策略與 MVP 需求，作為產品、設計與工程協作的共同依據。所有內容皆以「首波即上架 App Store 與 Google Play」為前提，聚焦提供家庭成員隨時可用的行動體驗。

---

## 1. 專案概述
- **目標**：打造透明可信的家庭零用錢管理工具，讓父母（Giver）掌握規則與金流，協助孩子（Baby）養成理財與記帳習慣。
- **策略**：直接採用 React Native + Expo 建置行動 App，同步開發 Go + Gin 後端，首版即符合商店審核標準。
- **核心價值**：即時互動、完整稽核、行動優先、易於擴充。

---

## 2. 痛點與成功畫面
- **透明的零用金流程**：避免口頭承諾與紙本記錄導致落差，提供規則、核銷與餘額的單一真實來源。
- **孩子的理財練習場**：提供簡單、安全的申請與記帳體驗，搭配照片或備註強化責任感。
- **即時信任機制**：送出請款、審核結果、零用金發放等事件皆能即時同步與通知，降低等待與誤解。

成功畫面：
1. Giver 可在手機上快速設定家庭、錢包、零用金規則並追蹤餘額。
2. Baby 透過 App 拍照上傳並送出請款，幾分鐘內收到審核結果。
3. 儀表板時間軸與統計圖表清楚呈現每筆金流，跨裝置資料一致。

---

## 3. 角色與需求對照
| 角色 | 需求重點 | 成功條件 |
| --- | --- | --- |
| Giver（父母/監護人） | 制定規則、審核請款、查看統計、安全控管 | 一機掌握家庭財務，推播提醒即時，稽核紀錄完整 |
| Baby（孩子） | 送出請款、附上證明、查詢餘額與歷史 | 流程簡單、通知快速、時間軸透明，體驗有趣且可信 |
| 系統管理員（選配） | 稽核、例外處理、客服與法規支援 | 可查閱操作紀錄、產生報表、調整系統參數與政策 |

---

## 4. 產品準則與策略
1. **Mobile First, Store Ready**：首版即順利上架 App Store / Google Play，後續再視需要擴充 Web 後台。
2. **單一真實來源**：MySQL 為唯一權威資料；行動端離線僅儲存佇列與快取，避免多副本衝突。
3. **可追溯與可信任**：所有金流與操作都可回溯，提供稽核日誌與通知紀錄。
4. **即時且自律**：推播、儀表板、提醒提供即時回饋，也引導孩子理解規則與等待。
5. **漸進式擴張**：先完成 MVP 核心旅程，再評估自動化、報表、付費方案等進階功能。

### 技術選擇
- **前端**：React Native + Expo Router（TypeScript），搭配 React Query、Zustand、Expo SQLite/MMKV、Expo Notifications。
- **後端**：Go 1.21 + Gin + GORM，採 REST API，預留 GraphQL/gRPC 擴充空間。
- **通知**：Firebase Cloud Messaging（含 Expo 通道）與 APNs，支援裝置註冊與偏好設定。
- **部署**：Docker 化後端，Expo EAS 產出 iOS/Android 建置；CI/CD 採 GitHub Actions。
- **安全**：Gmail OAuth2 + 自有帳密、JWT Access/Refresh Token、速率限制、稽核日誌。

---

## 5. MVP 功能範圍
### 5.1 帳號與家庭
- 支援 Email/密碼註冊、Gmail OAuth2 登入，首次登入選擇 Giver 或 Baby 身分。
- Giver 建立家庭並發送邀請（Email 或 QR Code）；Baby 接受後加入家庭。
- 成員可設定暱稱、頭像（可選）、語言、主題、通知偏好；Giver 可停用/啟用成員。

### 5.2 錢包管理
- 建立多個錢包（現金、銀行帳戶、信用卡、其他），設定幣別、初始餘額與警戒值。
- 餘額不得為負；支援編輯、停用與指定預設錢包；餘額以交易紀錄為準時更新。

### 5.3 零用金（Allowance）
- 建立定期（週/月/自訂）與臨時規則；排程執行時檢查餘額，成功扣款並建立交易。
- 餘額不足時狀態改為 `pending_funds` 並推播通知；支援啟停、修改金額與排程、查詢發放紀錄。

### 5.4 請款與審核（Request）
- Baby 可建立請款草稿，輸入金額、分類、用途、備註並附加照片檔案；離線可建立草稿。
- 送出後進入待審核，Giver 可核准、退回或要求補件並留下備註。
- 核准自動建立交易、扣除錢包餘額並通知雙方；退回則保留紀錄供追蹤。

### 5.5 交易與統計
- 每筆交易包含來源（Allowance/Request/Manual）、金額、幣別、分類、備註、時間。
- 儀表板顯示總餘額、待辦請款、近 30 日趨勢、分類比例；支援時間與分類篩選及分頁。

### 5.6 通知與提醒
- 原生推播涵蓋：請款送出、審核結果、零用金發放、餘額不足、排程錯誤。
- 支援裝置註冊/取消與勿擾時段，通知偏好可由成員調整。
- App 內提供通知中心，顯示未讀/已讀狀態並支援手動刷新。

### 5.7 多國語系與主題
- 內建繁體中文（預設）與英文；語系切換需即時生效，文案集中管理。
- 提供 default / light / dark 三種主題，支援跟隨系統或手動切換，並同步到伺服器。

### 5.8 離線支援與同步
- 離線狀態可建立請款草稿、編輯備註、瀏覽最近同步資料。
- 回線後透過 `/sync/operations` 批次送出，使用 `temp_id` 及冪等機制避免重複；同步結果需有回饋與重試選項。

### 5.9 資訊架構
- 導覽：Dashboard → 錢包 → 零用金 → 請款 → 交易 → 通知 → 設定。
- 3 步內完成主要操作（送出請款、核准請款、設定零用金）；表單具即時驗證與清楚錯誤提示。

---

## 6. 非功能性需求
| 項目 | 需求 |
| --- | --- |
| 性能 | API P95 < 300ms；App 啟動 < 4 秒；主要畫面切換 < 1 秒。 |
| 可用性 | 99% 正常運作；離線操作恢復連線後 1 分鐘內完成同步。 |
| 安全 | OAuth2 + JWT；Refresh Token 以 HttpOnly Cookie 或 Secure Store 儲存；密碼採 bcrypt；啟用速率限制與稽核日誌。 |
| 隱私 | 提供隱私政策、服務條款、帳號刪除流程；符合 Apple/Google 隱私申報。 |
| 可維護性 | 後端分層架構、前端功能模組化；程式碼需通過 lint、formatter、單元測試。 |
| 可觀測性 | 結構化日誌、Request ID、Prometheus 指標（請求數、錯誤率、排程延遲、推播送達率）。 |
| 無障礙 | 支援動態字級、VoiceOver/TalkBack、主題對比達 WCAG AA。 |
| 可擴充性 | API 保留版本化與多家庭擴充彈性；資料欄位保留幣別與 metadata。 |

---

## 7. 驗收與成功指標
- **功能場景**：
  1. Giver 註冊家庭 → 建立錢包 → 設定零用金 → Baby 請款 → Giver 審核 → 查看交易。
  2. Baby 離線建立請款 → 上線後自動同步 → Giver 收到通知並處理。
  3. 零用金排程自動發放 → 餘額更新 → 推播送達 → 儀表板顯示最新統計。
- **測試覆蓋**：後端核心模組 ≥ 70% 單元/整合測試；App 至少兩條 E2E（登入/請款/審核）。
- **品質門檻**：P0/P1 缺陷為 0；CI 中 lint/test/build 全通過；手動 QA 清單完成。
- **商店準備**：隱私政策、權限聲明、素材齊備，TestFlight/Internal Testing 成功發佈。
- **量化指標**：請款核准時間、通知送達率、離線同步成功率、活躍家庭數、Bug 修復 SLA。

---

## 8. 風險與假設
| 類別 | 說明 | 應對策略 |
| --- | --- | --- |
| 假設 | 使用者願意授權推播、相機、相簿 | Onboarding 清楚說明用途，提供設定入口與隱私承諾 |
| 假設 | 主要幣別為 TWD，未來可擴充 | 資料欄位保留幣別欄位；匯率非 MVP 範圍 |
| 風險 | App 審核延遲或退件 | 依 Apple/Google 指引撰寫隱私與權限文案，預留緩衝時間 |
| 風險 | 推播整合複雜 | 優先完成 FCM/APNs 設定並在實機測試；建立偵錯機制與重試策略 |
| 風險 | 離線同步錯誤 | 後端提供冪等檢查、清楚錯誤碼；App 顯示重試與回報入口 |
| 風險 | 家長與孩子的使用習慣差異 | 在封測階段蒐集回饋，調整引導與通知節奏 |

---

## 9. 文件地圖
- `doc/product-guide.md`（本檔）：產品願景、策略與 MVP 需求。
- `doc/sys-design.md`：系統架構、模組職責、資料模型與部署設計。
- `doc/plan-30d.md`：30 天行動計畫、里程碑與每日任務。
- 其他：`docs/api-outline.md`（API 介面）、`docs/data-model.md`（ER 圖/Schema）、`docs/deploy-playbook.md`（部署流程），視進度補齊。

如策略或需求有重大調整，請先更新本文件，再同步至設計、開發與計畫相關文件，確保全體團隊對目標保持一致。
